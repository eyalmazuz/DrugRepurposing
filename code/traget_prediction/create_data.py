import pandas as pd
import numpy as np
from tqdm import tqdm

#targets = ['NPBWR1', 'VCP', 'EPHB4', 'PTK2', 'S1PR2', 'ALPPL2', 'KDM4C', 'ESR1', 'EPHX2', 'TTR', 'EHMT2', 'ESR2', 'CASP1', 'S1PR1', 'CASP7', 'ALOX15', 'HTR1A', 'BAP1', 'MMP13', 'PRKACA', 'NR5A1', 'CDC25B', 'CTSB', 'RORA', 'HTR1E', 'BCL2A1A', 'HBB', 'CYP2C19', 'CTSS', 'CTSG', 'C1S', 'EPHA4', 'ROCK2', 'MAPK10', 'CTSL', 'EZH2', 'NCOA1', 'KDM4A', 'MTOR', 'KDM4E', 'SMN1', 'DCLRE1C', 'FPR1', 'FPR2', 'NFKB1', 'CYP3A4', 'NOX1', 'HSD17B10', 'CYP2D6', 'RELA', 'HIF1A', 'CYP1A2',]

#targets = ['MAOA', 'AURKB', 'IGF1R', 'EDNRA', 'CCR5', 'PIM1', 'ADORA2B', 'FLT3', 'P2RX7', 'ERBB2', 'HDAC1', 'CSF1R', 'MAPK8', 'DRD4', 'ABL1', 'CRHR1', 'DHFR', 'FGFR1', 'CHRM2', 'PDGFRB', 'GSTM1', 'MMP3', 'CHRM3', 'PLAU', 'BCHE', 'CCR2', 'ADRA1A', 'CDK1', 'CA9', 'CCKBR', 'FLT1', 'GNRHR', 'SCN9A', 'MAPKAPK2', 'JAK3', 'MAPK9', 'CTSK', 'ROCK1', 'CHRNA7', 'PARP1', 'KIT', 'PGR', 'NPY5R', 'PDE5A', 'PRKCD', 'HTR7', 'PTGS1', 'ADRB3', 'ADRA1D', 'ALK', 'INSR', 'PTGDR2', 'ADRB1', 'IKBKB', 'ITK', 'NOS1', 'RPS6KA3', 'AKT2', 'SOAT1', 'CCKAR', 'PIM2', 'ELANE', 'AKR1B1', 'LHCGR', 'OPRL1', 'NTRK1', 'HTR1B', 'CA12', 'NOS2', 'MPHOSPH8', 'GHSR', 'EDNRB', 'HRH1', 'RET', 'HRH4', 'PRKCA', 'PIK3CG', 'ADRA1B', 'TYRO3', 'AGTR1', 'CLK2', 'HTR2B', 'TBXA2R', 'FYN', 'TNF', 'PRKCG', 'SYK', 'PAK4', 'CHEK2', 'CDK5', 'PIK3CD', 'NEK2', 'CTSD', 'NTRK2', 'MAP4K4', 'HTR1D', 'PDPK1', 'MAP2K1', 'AKT3', 'TYMS', 'FLT4', 'PDE10A', 'HMGCR', 'DAPK3', 'LYN', 'BTK', 'CCR3', 'CSNK1D', 'IRAK4', 'DGAT1', 'PIK3CB', 'PRKCZ', 'HDAC6', 'RPS6KB1', 'THPO', 'TBXAS1', 'PRSS1', 'TAOK1', 'GCGR', 'PIM3', 'STK3', 'CXCR3', 'GRM1', 'PDE4B', 'CSNK1A1', 'LIMK1', 'DPP7', 'PRKCQ', 'MMP8', 'MC1R', 'XBP1', 'ERBB4', 'TGFBR1', 'TEK', 'PRKAA1', 'ACE', 'PLK3', 'GRM2', 'MAPK13', 'PTK2B', 'PRKD2', 'CSNK2A1', 'AVPR1B', 'CDC7', 'MAPKAPK3', 'EPHA2', 'P2RY12', 'CDC42BPA', 'PRKD3', 'MINK1', 'PRKX', 'MAPK12', 'DPP8', 'CAMK2D', 'PDGFRA', 'AVPR2', 'F2R', 'TYK2', 'PLG', 'YES1', 'FGFR3', 'MC3R', 'AGTR2', 'KIF11', 'GPR119', 'SGK2', 'AXL', 'CAMK1', 'BLK', 'SLC5A2', 'PKN2', 'HIPK2', 'ADRA2A', 'TMPRSS15', 'MARK2', 'MKNK2', 'PTGER3', 'TSPO', 'GCK', 'MARK3', 'CHUK', 'SLC6A9', 'MC5R', 'CSNK1G2', 'PAK1', 'BRSK1', 'MELK', 'SRPK1', 'PLK4', 'CYP17A1', 'BDKRB1', 'IRAK1', 'PTGER1', 'CAMK2B', 'NTRK3', 'PHKG2', 'CETP', 'APEX1', 'RAF1', 'STK17A', 'TACR2', 'RPS6KA5', 'MME', 'PRKDC', 'CSNK1G1', 'G6PD', 'MAPKAPK5', 'CAMK2G', 'ROS1', 'PTGER4', 'PTK6', 'KCNA5', 'PRKG1', 'FDFT1', 'TERT', 'HDAC8', 'CSNK1G3', 'CCR1', 'KPNA2', 'TSSK1B', 'HCRTR2', 'TBK1', 'MAP4K5', 'PTGES', 'FER', 'MTNR1A', 'HIPK4', 'HNF4A', 'FRK', 'BRAF', 'TNK2', 'TSSK2', 'PRKCI', 'CTBP1', 'NR3C2', 'HTR4', 'SLK', 'FFAR1', 'LRRK2', 'HTR3A', 'GRIN1', 'SCD1', 'ZAK', 'EIF4E', 'CALCRL', 'TACR3', 'HCAR2', 'DCLK1', 'MTNR1B', 'NR1H3', 'FES', 'DYRK1B', 'DPP9', 'EEF2K', 'NEK4', 'CYP11B2', 'IMPDH2', 'BRS3', 'DHODH', 'HCK', 'PDE4D', 'CXCR2', 'PBK', 'HSD17B1', 'GRM4', 'ADRA2C', 'PRKG2', 'GPBAR1', 'CDK4', 'SMO', 'FBP1', 'PTGDR', 'NOS3', 'PRKCB', 'LTA4H', 'RCE1', 'TOP1', 'MST1R', 'MGLL', 'GRK5', 'DYRK4', 'XIAP', 'PRCP', 'JAK1', 'CAPN1', 'METAP2', 'DYRK3', 'CYP11B1', 'RXFP2', 'SIRT2', 'CASR', 'CAMK1D', 'IKBKE', 'CDK7', 'ADK', 'MERTK', 'BACE2', 'PTPN2', 'PYGL', 'PDE4A', 'FKBP1A', 'MMP7', 'SRMS', 'ADRA2B', 'MAPK3', 'HSP90AB1', 'HSD17B2', 'SIRT1', 'HDAC2', 'KCNA3', 'SRD5A2', 'TRPA1', 'PLA2G1B', 'PRKCE', 'MAPK11', 'WNT3A', 'CXCL8', 'BDKRB2', 'SRD5A1', 'MATK', 'GRIN2B', 'SLC12A5', 'TOP2A', 'SLC6A1', 'CDK9', 'HRH2', 'ENPP2', 'AKR1C3', 'SLC9A1', 'CLK1', 'SCN5A', 'MMP12', 'PLA2G2A', 'PRKCH', 'ADAMTS5', 'ACACB', 'CDK8', 'ZAP70', 'PTAFR', 'CACNA1B', 'STS', 'CA14', 'CA7', 'AGTR1B', 'F7', 'BMP1', 'LTK', 'CACNA1G', 'HDAC4', 'SCD', 'ACACA', 'IDO1', 'NAMPT', 'SSTR2', 'CMA1', 'CAMK2A', 'SLC5A1', 'PLAT', 'THRA', 'AURKC', 'ACVR1', 'MAP2K2', 'ECE1', 'PDE7A', 'CCR4', 'PTPN11', 'CLK3', 'PREP', 'HSD11B2', 'DHFRP1', 'AKP3', 'PKLR', 'CACNA1D', 'S1PR5', 'LTB4R', 'CASP8', 'P2RY1', 'ABL2', 'SLC29A1', 'P2RY2', 'FGFR2', 'CXCR4', 'BRD4', 'UTS2R', 'ANPEP', 'CSK', 'STK10', 'PDE3A', 'SSTR1', 'RPS6KA1', 'SSTR3', 'LIPE', 'DDR2', 'GRIK1', 'FGR', 'GRIA2', 'TGM2', 'GRM3', 'DYRK2', 'PNP', 'MLNR', 'EPHB2', 'NUAK1', 'ALOX5AP', 'NQO2', 'CA4', 'MLYCD', 'MPL', 'EGLN1', 'CHRNA4', 'ICMT', 'P2RX3', 'SGK1', 'CDC25A', 'PLA2G4A', 'FOLH1', 'MAP3K7', 'PLK2', 'PLD2', 'RPS6KA4', 'BMX', 'C5AR1', 'MAP3K5', 'PLD1', 'STK4', 'CES1', 'TPSAB1', 'NTSR2', 'SLC10A2', 'HIPK1', 'TXK', 'MUSK', 'SIK1', 'SLC6A5', 'ST14', 'PASK', 'TRPM8', 'GRB2', 'TTK', 'RARB', 'GRIA1', 'AKR1C2', 'MIF', 'RPS6KA2', 'SCN10A', 'CSNK2A2', 'MARK1', 'FDPS', 'PDE2A', 'MYLK', 'PLIN1', 'HSD17B3', 'SELP', 'PTPRC', 'KDM1A', 'EPHA3', 'SSTR5', 'SLC18A3', 'ADAMTS4', 'SCN2A', 'MAP3K9', 'P2RY6', 'BRSK2', 'SLCO1B1', 'SERPINE1', 'DRD5', 'FAP', 'MAP3K8', 'CXCR1', 'TLR7', 'EPHB3', 'TEC', 'SPHK1', 'LSS', 'TNKS', 'TNKS2', 'RIPK2', 'KCNMA1', 'CDK19', 'RPS6KA6', 'GRK7', 'CA5A', 'NLK', 'EPHB1', 'PAK2', 'PAK7', 'SHH', 'EPHA5', 'SI', 'PAK3', 'SGK3', 'FGFR4', 'EPHA8', 'ACVR1B', 'RARG', 'XDH', 'METAP1', 'CA6', 'CAMK4', 'INSRR', 'PSMB5', 'PAK6', 'DAPK1', 'HIPK3', 'PTGIR', 'EPHA7', 'SRPK3', 'CDC42BPB', 'SENP1', 'DAPK2', 'NEK6', 'TAOK3', 'ACR', 'MAP2K6', 'KLKB1', 'EPHA1', 'GART', 'F9', 'DMPK', 'RXRB', 'CCR8', 'STAT6', 'RXRG', 'STK11', 'CACNA2D1', 'ALPI', 'IDH1', 'CFTR', 'CHRM1', 'NFE2L2',]

# targets = ['ALPI', 'IDH1', 'CFTR', 'CHRM1', 'NFE2L2', 'GLP1R', 'DRD3', 'SMAD3', 'APOBEC3G', 'GLS', 'SLC1A1', 'PPOX', 'UGCG', 'VCAM1', 'BAD', 'EP300', 'CHKA', 'PARP2', 'BRD3', 'SLC1A2', 'NRP1', 'ABCB1A', 'NPC1L1    ', 'F13A1', 'PHKG1', 'AGTR1A', 'HMOX2', 'DDR1', 'CPB2', 'MARS', 'FSHR', 'FFAR4', 'TGFBR2', 'MAP3K11', 'PDK1', 'SORD', 'ABCC9', 'LPAR2', 'ABCB1B', 'CAMKK2', 'CTRB1', 'PGGT1B', 'CDC25C', 'SELL', 'TGM1'    , 'NT5E', 'ALB', 'CDK6', 'MTAP', 'HPRT1', 'HMOX1', 'GPR32', 'CPB1', 'AMD1', 'SLC27A1', 'MARK4', 'PTPRA', 'KLK1', 'SCN4A', 'EGLN3', 'NAAA', 'CACNA1S', 'F2RL1', 'FUCA1', 'KMO', 'CSNK1E', 'MPO', 'HCAR3'    , 'CAR13', 'HLA-A', 'NR1D1', 'SFRP1', 'CAR15', 'MAP2K5', 'PTPRB', 'PSMB2', 'TMPRSS6', 'TNIK', 'IL5', 'FFAR2', 'MAP3K10', 'MGMT', 'RGS8', 'HAO2', 'EBP', 'HPGDS', 'UTS2', 'GABRA5', 'TYR', 'TUBB1', 'GAK    ', 'ACOX1', 'FCER2', 'AKR1A1', 'PDE9A', 'GRPR', 'RIPK1', 'POLA1', 'CYP2A6', 'MAP3K19', 'GABRA2', 'DLG4', 'TKT', 'RHOA', 'UGT2B7', 'FKBP5', 'SLC47A1', 'NEK9', 'TK2', 'ALKBH3', 'TMPRSS11D', 'CTSE', 'PD    F', 'EGLN2', 'PSMB1', 'DOT1L', 'C1R', 'CDK3', 'GUSB', 'STK16', 'GRM6', 'ERCC5', 'ASIC3', 'GBA2', 'AAK1', 'SLC22A2', 'ACE2', 'MMP16', 'CBX7', 'ERN1', 'WNT3', 'TLR8', 'DNM1', 'ALDH2', 'PORCN', 'PLA2G10    ', 'CPA1', 'ADA', 'CDK16', 'BMP2K', 'NMT1', 'NAT2', 'TPH1', 'CX3CR1', 'RASGRP3', 'KCNN4', 'EPHA6', 'ITGAV', 'GRIK3', 'STK26', 'CASP2', 'EPHB6', 'PRKAA2', 'LDHB', 'CAMKK1', 'NCEH1', 'FABP3', 'UPP1', '    ACKR3', 'LOC400927-CSNK1E', 'EPHX1', 'GRM8', 'APOB', 'PDE1C', 'CSGALNACT1', 'PDE6A', 'GRIN2D', 'MYLK2', 'AMPD3', 'CHAT', 'ABHD6', 'SUCNR1', 'AGER', 'PDE6D', 'STK17B', 'SLC16A1', 'KCNJ11', 'MAPK7', 'G    HRL', 'ADCY1', 'ADCY5', 'MCHR2', 'SUMO2', 'ABCC8', 'FAS', 'CHRNA10', 'PTGES2', 'EIF2AK4', 'SLC11A2', 'NAT1', 'SLC22A6', 'OXER1', 'HLA-DRB1', 'HCN4', 'EIF2AK1', 'MAP3K4', 'LIPG', 'TIE1', 'ITGA2B', 'AB    AT', 'CD22', 'SCNN1A', 'JMJD7-PLA2G4B', 'DAGLA', 'BMPR1B', 'LDLR', 'STK36', 'SORT1', 'GYS1', 'MAP4K1', 'BIRC3', 'VIPR1', 'NEK1', 'IARS', 'MAP4K3', 'CIT', 'OXGR1', 'IGFBP3', 'NUAK2', 'CYP24A1', 'CAMK1    G', 'GABRA3', 'NFKBIA', 'MAP3K2', 'CYP51A1', 'CTSH', 'TLR2', 'PGC', 'RBP4', 'ESRRB', 'PLA2G5', 'PLAUR', 'PKN1', 'KHDRBS1', 'ASAH1', 'PKD2', 'PADI1', 'HNMT', 'ALDH3A1', 'MAP3K14', 'HCN1', 'AMPD2', 'SL    C27A4', 'AADAT', 'PGA5', 'CCL2', 'BMP4', 'ADAM9', 'GRM7', 'LGMN', 'PADI2', 'FPGS', 'CACNA1I', 'CTSA', 'MAPK15', 'ADM', 'MAG', 'WDR5', 'BMPR2', 'BIRC5', 'TRPV4', 'NIACR1', 'GRK4', 'PRMT3', 'SLC22A12',     'GRIA3', 'DCLK3', 'MMP11', 'IRAK3', 'SLC5A4', 'PI4KA', 'PADI3', 'MAP2K4', 'CTSF', 'EIF4A1', 'PIP5K1A', 'ENPEP', 'TNNI3K', 'GRIK5', 'MGAT2', 'PTGDS', 'RIOK1', 'STK25', 'RIOK3', 'ITPR1', 'MOGAT2', 'ER    BB3', 'PIK3C2B', 'RIOK2', 'SMG1', 'CCL5', 'ANKK1', 'MBTPS1', 'PIP4K2C', 'TRAP1', 'CDKL2', 'TESK1', 'PIP4K2B', 'PFDN6', 'MAP2K3', 'PSEN1', 'GPR17', 'CACNA2D2', 'GALR1', 'ACVRL1', 'PSMB8', 'STK35', 'PA    M', 'LATS2', 'KLK3', 'PROKR1', 'PCNA', 'CD74', 'PCK1', 'MYLK4', 'GHRHR', 'CENPE', 'GRK1', 'CDK17', 'PRSS8', 'TRPC3', 'MYLK3', 'MAP3K13', 'CYP2J2', 'SLC10A1', 'YARS', 'ULK1', 'CDK14', 'MAP3K12', 'RORB    ', 'MMP15', 'ADCK4', 'RIPK4', 'CYBB', 'CHRNA6', 'ACVR2B', 'ICK', 'DSTYK', 'PCSK6', 'HSP90B1', 'GZMB', 'DPEP1', 'SBK1', 'CDK18']


#targets = ['BCL2', 'BTK']

print('Loading data')
df = pd.read_csv('./raw_yeast.tsv', sep='\t', usecols=['Gene_Symbol', 'Activity_Flag', 'SMILES'])

print('Getting only target')
#tdf = df[df['Gene_Symbol'].isin(targets)]

print('Converting activities')
df['Activity_Flag'] = df['Activity_Flag'].apply(lambda x: 1 if x == "A" else 0)

print('Creating pivot table')
pt = pd.pivot_table(df, values='Activity_Flag', index='SMILES', columns='Gene_Symbol', dropna=False, fill_value=2)
print(pt.shape)

print('Cast to int')
for col in tqdm(pt.columns):
    if pt[col].dtype == float:
        pt[col] = pt[col].astype(int)

pt.index.rename('Smiles', inplace=True)
print('Saving')        
pt.to_csv('./all_matrix.csv')
